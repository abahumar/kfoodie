---
import BlogLayout from '../../../layouts/BlogLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const allPosts = await getCollection('blog');
	const uniqueCategories = [...new Set(allPosts.map((post) => post.data.category))];

	return uniqueCategories.map((category) => {
		const filteredPosts = allPosts.filter((post) => post.data.category === category);
		// Simple slugify for matching the manual links in index.astro
		const slug = category.toLowerCase().replace(/\s+/g, '-');
		return {
			params: { category: slug },
			props: { category, posts: filteredPosts },
		};
	});
}

const { category, posts } = Astro.props;
posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BlogLayout title={`${category} - KelantanFoodie`} description={`Best ${category} in Kelantan.`}>
	<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
		<div class="mb-12">
			<a href="/kfoodie/" class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-primary mb-6 transition-colors">
				<svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
				</svg>
				Back to Home
			</a>
			<h1 class="text-4xl md:text-5xl font-bold text-gray-900 capitalise tracking-tight">
				<span class="block text-primary text-lg font-bold uppercase tracking-wider mb-2">Category</span>
				{category}
			</h1>
		</div>
		
		{posts.length > 0 ? (
			<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
				{posts.map(post => {
					// Dummy category for now if not present
					const postCategory = post.data.category || category;
					return (
						<article class="group cursor-pointer">
							<div class="relative rounded-3xl overflow-hidden aspect-[4/3] mb-6 bg-gray-100 shadow-sm">
								{post.data.image && (
									<img 
										src={post.data.image} 
										alt={post.data.title} 
										class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
									/>
								)}
								
								<!-- Hover overlay gradient -->
								<div class="absolute inset-0 bg-black/10 group-hover:bg-black/20 transition-colors duration-300"></div>

								<!-- Arrow Button -->
								<div class="absolute bottom-4 right-4 w-10 h-10 bg-black/30 backdrop-blur-sm rounded-xl flex items-center justify-center text-white group-hover:bg-primary group-hover:text-white transition-all duration-300">
									<svg width="10" height="10" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M1 11L11 1M11 1H1M11 1V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
									</svg>
								</div>
							</div>
							
							<div class="space-y-3">
								<div class="inline-block px-3 py-1 rounded-full bg-gray-100 text-xs font-semibold text-gray-600 uppercase tracking-wider">
									{postCategory}
								</div>
								
								<h2 class="text-xl font-bold text-gray-900 leading-snug group-hover:text-primary transition-colors">
									<a href={`/kfoodie/blog/${post.slug}`}>
										{post.data.title}
									</a>
								</h2>
								
								<div class="flex items-center text-sm text-gray-500 mb-2">
									<time>{post.data.pubDate.toLocaleDateString('en-MY', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
								</div>

								<p class="text-gray-500 text-sm leading-relaxed line-clamp-3">
									{post.data.description}
								</p>
							</div>
						</article>
					)
				})}
			</div>
		) : (
			<div class="text-center py-20 bg-gray-50 rounded-3xl border border-gray-100">
				<p class="text-gray-500 text-lg">No posts found for this category.</p>
				<a href="/kfoodie/" class="mt-4 inline-block text-primary font-medium hover:underline">Explore other categories</a>
			</div>
		)}
	</div>
</BlogLayout>
