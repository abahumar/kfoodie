---
import BlogLayout from '../../../layouts/BlogLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const allPosts = await getCollection('blog');
	const uniqueCategories = [...new Set(allPosts.map((post) => post.data.category))];

	return uniqueCategories.map((category) => {
		const filteredPosts = allPosts.filter((post) => post.data.category === category);
		// Simple slugify for matching the manual links in index.astro
		const slug = category.toLowerCase().replace(/\s+/g, '-');
		return {
			params: { category: slug },
			props: { category, posts: filteredPosts },
		};
	});
}

const { category, posts } = Astro.props;
posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BlogLayout title={`${category} - KelantanFoodie`} description={`Best ${category} in Kelantan.`}>
	<div class="header-section">
		<a href="/blog" class="back-link">‚Üê Back to all posts</a>
		<h1>{category}</h1>
	</div>
	
	{posts.length > 0 ? (
		<ul class="post-list">
			{posts.map(post => (
				<li>
					<a href={`/blog/${post.slug}`} class="post-link">
						<h2 class="post-title">{post.data.title}</h2>
					</a>
					<div class="post-meta">
						<time>{post.data.pubDate.toLocaleDateString('en-MY', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
					</div>
					<p>{post.data.description}</p>
				</li>
			))}
		</ul>
	) : (
		<p>No posts found for this category.</p>
	)}
</BlogLayout>

<style>
	.header-section {
		margin-bottom: 2rem;
	}
	.back-link {
		color: #666;
		text-decoration: none;
		font-size: 0.9rem;
		margin-bottom: 1rem;
		display: inline-block;
	}
	.back-link:hover {
		text-decoration: underline;
	}
	h1 {
		font-size: 2.5rem;
		margin: 0.5rem 0;
		text-transform: capitalize;
	}
	.post-list {
		list-style: none;
		padding: 0;
	}
	li {
		margin-bottom: 2rem;
		border-bottom: 1px solid #eee;
		padding-bottom: 2rem;
	}
	.post-link {
		text-decoration: none;
		color: inherit;
	}
	.post-title {
		margin-bottom: 0.5rem;
		color: #d32f2f;
	}
	.post-link:hover .post-title {
		text-decoration: underline;
	}
	.post-meta {
		font-size: 0.9rem;
		color: #666;
		margin-bottom: 0.5rem;
	}
</style>
